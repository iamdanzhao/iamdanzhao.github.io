<!DOCTYPE html>
<html>
<head>
    <title>TransitScreen</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Condensed:wght@200;400;600&display=swap" rel="stylesheet">
    <style>

        body {
            font-family: 'IBM Plex Sans Condensed';
            background-color: #EEEEEE;
            margin: 24px;
        }

        .intro-text {
            text-align: right;
            font-size: 300%;
        }

        h1 {
            margin-left: 24px;
            font-size: 275%;
            margin-bottom: 12px;
            text-transform: uppercase;
            font-color: gray;
        }

        h2 {
            font-size: 175%;
        }

        .column {
            background-color: white;
            margin: 12px;
            border-radius: 4px;
            float: left;
            padding: 16px;
            width: calc(33.33% - 56px);
        }

        .section-header {
            border-bottom: 1px dotted gray;
            margin-bottom: 18px;
            padding-bottom: 12px;
        }

        .section-header * {
            display: inline;
            vertical-align: middle;
        }

        .section-header-times {
            float: right;
            margin-top: 6px;
        }

        .section-header-times * {
            height: 18px;
            margin: 0 2px;
            text-transform: uppercase;
            font-weight: bold;
        }

        h4 {
            font-size: 125%;
            text-transform: uppercase;
            margin: 6px 0;
        }

        /* Clear floats after the columns */
        .row:after {
            content: "";
            display: table;
            clear: both;
        }

        .line-OR {
            background-color: #ED8B00;
            color: white;
        }

        .line-BL {
            background-color: #009CDE;
            color: white;
        }

        .line-SV {
            background-color: #919D9D;
            color: white;
        }

        .line-RD {
            background-color: #BF0D3E;
            color: white;
        }

        .bike-available {
            background-color: rgb(62, 155, 89);
            color: white;
        }

        .bike-low {
            background-color: rgb(239, 178, 86);
            color: black;
        }

        .bike-none {
            background-color: rgb(63, 59, 54);
            color: white;
        }

        .train-node.line-empty {
            height: 84px;
            background-color: white;
            color: darkgray;
            border: 1px solid #eee;
        }

        .train-node {
            display: inline-block;
            padding: 6px 10px;
            margin: 4px;
            border-radius: 4px;
            height: 84px;
            width: calc(33.3% - 30px);
        }

        .train-node:nth-child(3n+1) {
            margin-left: 0;
        }

        .train-node:nth-child(3n+3) {
            margin-right: 0;
        }

        .train-node-wrapper {
            margin: 8px 0 16px 0;
        }

        .train-node-wrapper:last-child {
            margin-bottom: 0;
        }

        .train-node-time {
            font-size: 325%;
            font-weight: bold;
            line-height: 100%;
        }

        .train-node-label {
            text-transform: uppercase;
        }

        .train-node-dest {
            font-size: 150%;
            display: block;
        }

        .bus-node {
            background-color: #ededed;
        }

        .info-panel-time {
            display: block;
        }

        .info-panel-weather {
            display: block;
        }

        @media screen and (min-width: 1700px) {
            body {
                font-size: 115%;
            }

            h1 {
                font-size: 250%;
            }

            .train-node, .train-node.line-empty {
                height: 96px;
            }
        }

        @media screen and (max-width: 1400px) {
            .column {
                width: calc(100% - 56px) !important;
            }
        }

    </style>
</head>
<body>

    
    <h1 id="current-time-header">Get moving, you're probably late!</h1>
    <div class="row">
        <div class="column" id="container-metrorail">
            <div class="section-header">
                <h2>Foggy Bottom-GWU</h2>
                <span class="section-header-times">
                    <img src="https://cdn-icons-png.flaticon.com/512/499/499693.png">
                    <span>8 min</span>
                </span>  
            </div>
            <h4>→ East to DC, MD</h4>
            <div class="train-node-wrapper" id="foggy-eastbound"></div>
            <h4>← West to VA</h4>
            <div class="train-node-wrapper" id="foggy-westbound"></div>
            <div class="section-header">
                <h2>Farragut North</h2>
                <span class="section-header-times">
                    <img src="https://cdn-icons-png.flaticon.com/512/499/499693.png">
                    <span>22 min</span>
                    <img src="https://cdn-icons-png.flaticon.com/512/565/565350.png">
                    <span>10 min</span>
                </span>  
            </div>
            <h4>→ East to Glenmont</h4>
            <div class="train-node-wrapper" id="farragut-eastbound"></div>
            <h4>← West to Shady Grove</h4>
            <div class="train-node-wrapper" id="farragut-westbound"></div>
        </div>
        <div class="column">
            <div class="section-header">
                <h2>23 & G St NW</h2>
                <span class="section-header-times">
                    <img src="https://cdn-icons-png.flaticon.com/512/499/499693.png">
                    <span>4 min</span>
                </span>
            </div>
            <h4>→ 32 & 36 Eastbound Penn Ave</h4>
            <div class="train-node-wrapper" id="penn-eastbound">
            </div>
            <h4>← 31 Northbound Wisconsin Ave</h4>
            <div class="train-node-wrapper" id="wisconsin-northbound">
            </div>
            <div class="section-header">
                <h2>F & 22 St NW</h2>
                <span class="section-header-times">
                    <img src="https://cdn-icons-png.flaticon.com/512/499/499693.png">
                    <span>4 min</span>
                </span>
            </div>
            <h4>→ 42 & 43 Northbound Mt. Pleasant</h4>
            <div class="train-node-wrapper" id="mt-pleasant-northbound">
            </div>
        </div>
        <div class="column">
            <div class="section-header">
                <h2>Capital Bikeshare</h2>
            </div>
            <div class="train-node-wrapper" id="cabi-all"></div>
        </div>
        <div class="column">
            <span class="info-panel-time">It's 12:00 AM on Monday, January 1, 1970.</span>
            <span class="info-panel-weather">100° with a chance of meatballs.</span>
        </div>
    </div>
    
    <script type="text/javascript">
        const wmata_api = 'c95cc07e054c4a0aa4410440992b0bbd';
        const refresh_rate = 30000; // 30 seconds

        // Header
        function LoadBasics() {
            var curDate = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            document.getElementById("current-time-header").innerHTML = "It's <span style=\"color: #009CDE;\">" + curDate + "</span> and you're probably running late.";
        }

        // Foggy Bottom-GWU
        function LoadFoggyBottom () {
            $(function() {
                var params = {
                    "api_key": wmata_api,
                };
            
                $.ajax({
                    url: "https://api.wmata.com/StationPrediction.svc/json/GetPrediction/C04?" + $.param(params),
                    type: "GET",
                })
                .done(function(data) {
                    var trains = data.Trains;

                    document.getElementById("foggy-eastbound").innerHTML = "";
                    document.getElementById("foggy-westbound").innerHTML = "";

                    for (let i = 0; i < trains.length; i++) {
                        var container;

                        if (trains[i].Group === '1')
                            container = document.getElementById("foggy-eastbound");
                        else
                            container = document.getElementById("foggy-westbound");

                        var status = trains[i].Min;
                        var labelText = "min";

                        if (status === "ARR" || status === "BRD")
                            labelText = "";

                        container.innerHTML += "<div class=\"train-node line-" + trains[i].Line + "\"><span class=\"train-node-time\">" + trains[i].Min + "</span><span class=\"train-node-label\">" + labelText + "</span><span class=\"train-node-dest\">" + trains[i].Destination + "</span></div>"
                    }

                    if (document.getElementById("foggy-eastbound").innerHTML === "")
                        document.getElementById("foggy-eastbound").innerHTML = "<div class=\"train-node line-empty\"><span class=\"train-node-time\">∞</span><span class=\"train-node-label\">min</span><span class=\"train-node-dest\">No train</span></div>";
                
                    if (document.getElementById("foggy-westbound").innerHTML === "")
                        document.getElementById("foggy-westbound").innerHTML = "<div class=\"train-node line-empty\"><span class=\"train-node-time\">∞</span><span class=\"train-node-label\">min</span><span class=\"train-node-dest\">No train</span></div>";
                
                })
                .fail(function() {
                    document.getElementById("foggy-westbound").innerHTML = "<div class=\"train-node line-empty\"><span class=\"train-node-time\">∞</span><span class=\"train-node-label\">min</span><span class=\"train-node-dest\">API error</span></div>";
                    document.getElementById("foggy-eastbound").innerHTML = "<div class=\"train-node line-empty\"><span class=\"train-node-time\">∞</span><span class=\"train-node-label\">min</span><span class=\"train-node-dest\">API error</span></div>";
                });
            });
        }

        // Farragut North
        function LoadFarragutNorth() {
            $(function() {
                var params = {
                    "api_key": wmata_api,
                };
            
                $.ajax({
                    url: "https://api.wmata.com/StationPrediction.svc/json/GetPrediction/A02?" + $.param(params),
                    type: "GET",
                })
                .done(function(data) {
                    var trains = data.Trains;

                    document.getElementById("farragut-eastbound").innerHTML = "";
                    document.getElementById("farragut-westbound").innerHTML = "";

                    for (let i = 0; i < trains.length; i++) {
                        var container;

                        if (trains[i].Group === '1')
                            container = document.getElementById("farragut-eastbound");
                        else
                            container = document.getElementById("farragut-westbound");

                        var status = trains[i].Min;
                        var labelText = "min";

                        if (status === "ARR" || status === "BRD")
                            labelText = "";

                        container.innerHTML += "<div class=\"train-node line-" + trains[i].Line + "\"><span class=\"train-node-time\">" + trains[i].Min + "</span><span class=\"train-node-label\">" + labelText + "</span><span class=\"train-node-dest\">" + trains[i].Destination + "</span></div>"
                    }

                    if (document.getElementById("farragut-eastbound").innerHTML === "")
                        document.getElementById("farragut-eastbound").innerHTML = "<div class=\"train-node line-empty\"><span class=\"train-node-time\">∞</span><span class=\"train-node-label\">min</span><span class=\"train-node-dest\">No train</span></div>";
                
                    if (document.getElementById("farragut-westbound").innerHTML === "")
                        document.getElementById("farragut-westbound").innerHTML = "<div class=\"train-node line-empty\"><span class=\"train-node-time\">∞</span><span class=\"train-node-label\">min</span><span class=\"train-node-dest\">No train</span></div>";
                })
                .fail(function() {
                    document.getElementById("farragut-westbound").innerHTML = "<div class=\"train-node line-empty\"><span class=\"train-node-time\">∞</span><span class=\"train-node-label\">min</span><span class=\"train-node-dest\">API error</span></div>";
                    document.getElementById("farragut-eastbound").innerHTML = "<div class=\"train-node line-empty\"><span class=\"train-node-time\">∞</span><span class=\"train-node-label\">min</span><span class=\"train-node-dest\">API error</span></div>";
                });
            });
        }

        // Bus
        function LoadBus3X() {
            $(function() {
                var params = {
                    "api_key": wmata_api,
                    "StopID": "1001082",
                };
            
                $.ajax({
                    url: "https://api.wmata.com/NextBusService.svc/json/jPredictions?" + $.param(params),
                    type: "GET",
                })
                .done(function(data) {
                    var buses = data.Predictions;

                    document.getElementById("penn-eastbound").innerHTML = "";
                    document.getElementById("wisconsin-northbound").innerHTML = "";
                    
                    for (let i = 0; i < buses.length; i++) {
                        var dest = ""

                        if (buses[i].RouteID === '32') {
                            container = document.getElementById("penn-eastbound");
                            dest = "32 Southern";
                        }
                        else if (buses[i].RouteID === '36') {
                            container = document.getElementById("penn-eastbound");
                            dest = "36 Naylor";
                        }
                        else {
                            container = document.getElementById("wisconsin-northbound");
                            dest = "31 Frndshp";
                        }

                        container.innerHTML += "<div class=\"train-node bus-node\"><span class=\"train-node-time\">" + buses[i].Minutes + "</span><span class=\"train-node-label\">min</span><span class=\"train-node-dest\">" + dest + "</span></div>"
                    }

                    if (document.getElementById("penn-eastbound").innerHTML === "")
                        document.getElementById("penn-eastbound").innerHTML = "<div class=\"train-node line-empty\"><span class=\"train-node-time\">∞</span><span class=\"train-node-label\">min</span><span class=\"train-node-dest\">No bus</span></div>";
                
                    if (document.getElementById("wisconsin-northbound").innerHTML === "")
                        document.getElementById("wisconsin-northbound").innerHTML = "<div class=\"train-node line-empty\"><span class=\"train-node-time\">∞</span><span class=\"train-node-label\">min</span><span class=\"train-node-dest\">No bus</span></div>";

                })
                .fail(function() {
                    document.getElementById("penn-eastbound").innerHTML = "<div class=\"train-node line-empty\"><span class=\"train-node-time\">∞</span><span class=\"train-node-label\">min</span><span class=\"train-node-dest\">API error</span></div>";
                    document.getElementById("wisconsin-northbound").innerHTML = "<div class=\"train-node line-empty\"><span class=\"train-node-time\">∞</span><span class=\"train-node-label\">min</span><span class=\"train-node-dest\">API error</span></div>";

                });
            });
        }
        function LoadBus4X() {
            $(function() {
                var params = {
                    "api_key": wmata_api,
                    "StopID": "1001044",
                };
            
                $.ajax({
                    url: "https://api.wmata.com/NextBusService.svc/json/jPredictions?" + $.param(params),
                    type: "GET",
                })
                .done(function(data) {
                    var buses = data.Predictions;

                    document.getElementById("mt-pleasant-northbound").innerHTML = "";
                    
                    for (let i = 0; i < buses.length; i++) {
                        var container = document.getElementById("mt-pleasant-northbound");
                        var dest = "";

                        if (buses[i].RouteID === '42') {
                            dest = "42 Mt. Plsnt";
                        }
                        else if (buses[i].RouteID === '43') {
                            dest = "43 Mt. Plsnt";
                        }
                        else {
                            continue;
                        }

                        container.innerHTML += "<div class=\"train-node bus-node\"><span class=\"train-node-time\">" + buses[i].Minutes + "</span><span class=\"train-node-label\">min</span><span class=\"train-node-dest\">" + dest + "</span></div>"
                    }

                    if (document.getElementById("mt-pleasant-northbound").innerHTML === "")
                        document.getElementById("mt-pleasant-northbound").innerHTML = "<div class=\"train-node line-empty\"><span class=\"train-node-time\">∞</span><span class=\"train-node-label\">min</span><span class=\"train-node-dest\">No bus</span></div>";
                })
                .fail(function() {
                    document.getElementById("penn-eastbound").innerHTML = "<div class=\"train-node line-empty\"><span class=\"train-node-time\">∞</span><span class=\"train-node-label\">min</span><span class=\"train-node-dest\">API error</span></div>";
                    document.getElementById("wisconsin-northbound").innerHTML = "<div class=\"train-node line-empty\"><span class=\"train-node-time\">∞</span><span class=\"train-node-label\">min</span><span class=\"train-node-dest\">API error</span></div>";

                });
            });
        }
        
        // Bike
        function LoadCaBi() {
            $.getJSON('https://api.citybik.es/capital-bikeshare.json', function(data) {
                stations = [126, 482, 609];
                names = ['23 & E St', 'Va. & 25 St', '22 & H St'];
                className = "bike-available";

                document.getElementById("cabi-all").innerHTML = "";

                for (var i = 0; i < stations.length; i++) {
                    const available = data.filter(d => d.number === stations[i])[0].bikes;
                    const freeDocks = data.filter(d => d.number === stations[i])[0].free;
                    const total = available + freeDocks;

                    if (available == 0) {
                        className = "bike-none"
                    }
                    else if (available <= 2) {
                        className = "bike-low"
                    }

                    document.getElementById("cabi-all").innerHTML += "<div class=\"train-node " + className + "\"><span class=\"train-node-time\">" + available + "</span><span class=\"train-node-label\">/" + total + "</span><span class=\"train-node-dest\">" + names[i] + "</span></div>"
                }
            });
        }
    
        // Load everything
        function LoadAll() {
            LoadFoggyBottom();
            LoadFarragutNorth();
            LoadBus3X();
            LoadBus4X();
            LoadCaBi();
        }
        
        LoadAll();
        setInterval(LoadAll, refresh_rate);

        LoadBasics();
        setInterval(LoadBasics, 5000);
    </script>
</body>
</html>